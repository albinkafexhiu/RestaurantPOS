@model RestaurantPOS.Web.Models.OrderDetailsViewModel
@using RestaurantPOS.Domain.Enums

@{
    ViewData["Title"] = $"Table {Model.TableNumber} - POS";
}

<h2>Table @Model.TableNumber - POS</h2>

@if (!Model.HasOpenOrder)
{
    <h4>No open order for this table.</h4>
    <p>Select waiter and start a new order.</p>

    <form asp-action="StartOrder" method="post">
        <input type="hidden" name="tableId" value="@Model.TableId" />

        <div class="form-group">
            <label>Waiter</label>
            <select name="waiterId" class="form-control">
                <option value="">-- select waiter --</option>
                @foreach (var w in Model.Waiters)
                {
                    <option value="@w.Value">@w.Text</option>
                }
            </select>
        </div>

        <button type="submit" class="btn btn-primary mt-2">Start Order</button>
        <a asp-action="Index" class="btn btn-secondary mt-2">Back to tables</a>
    </form>
}
else
{
    <div class="row">
        <div class="col-md-7">
            <h4>Items</h4>

            @if (Model.Items.Any())
            {
                <table class="table">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Qty</th>
                            <th>Unit price</th>
                            <th>Total</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                    @foreach (var item in Model.Items)
                    {
                        <tr>
                            <td>@item.ProductName</td>
                            <td>@item.Quantity</td>
                            <td>@item.UnitPrice</td>
                            <td>@item.LineTotal</td>
                            <td>
                                <form asp-action="RemoveItem" method="post" style="display:inline">
                                    <input type="hidden" name="tableId" value="@Model.TableId" />
                                    <input type="hidden" name="orderItemId" value="@item.OrderItemId" />
                                    <button type="submit" class="btn btn-sm btn-danger">Remove</button>
                                </form>
                            </td>
                        </tr>
                    }
                    </tbody>
                </table>
            }
            else
            {
                <p>No items in this order yet.</p>
            }

            <h4>Total: @Model.Total</h4>

            <form asp-action="CloseOrder" method="post" class="mt-3">
                <input type="hidden" name="tableId" value="@Model.TableId" />
                <input type="hidden" name="orderId" value="@Model.OrderId" />

                <div class="form-group">
                    <label>Payment method</label>
                    <select name="paymentMethod" class="form-control">
                        <option value="@PaymentMethod.Cash">Cash</option>
                        <option value="@PaymentMethod.Card">Card</option>
                        <option value="@PaymentMethod.Other">Other</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-success mt-2">Close Order</button>
                <a asp-action="Index" class="btn btn-secondary mt-2">Back to tables</a>
            </form>
        </div>

        <div class="col-md-5">
            <h4>Add Item</h4>

            <form asp-action="AddItem" method="post">
                <input type="hidden" name="tableId" value="@Model.TableId" />
                <input type="hidden" name="orderId" value="@Model.OrderId" />

                <div class="form-group">
                    <label>Product</label>
                    <select name="productId" class="form-control">
                        <option value="">-- select product --</option>
                        @foreach (var p in Model.Products)
                        {
                            <option value="@p.Id">@p.Name (@p.Price)</option>
                        }
                    </select>
                </div>

                <div class="form-group">
                    <label>Quantity</label>
                    <input type="number" name="quantity" value="1" min="1" class="form-control" />
                </div>

                <button type="submit" class="btn btn-primary mt-2">Add to order</button>
            </form>
        </div>
    </div>
}
